@model ProyectoFinal.Areas.Admin.Models.ViewModels.AgregarViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "LayoutAdmin";
}

<div class="admin-card">
    <h2 class="admin-title">Agregar Nuevo Producto</h2>

    <form class="admin-form" method="post" asp-action="Agregar" asp-controller="Home" enctype="multipart/form-data">
        <div class="form-group">
            <label for="nombre" class="form-label">Nombre del Producto</label>
            <input asp-for="Agregar.Nombre" type="text" id="nombre" class="form-input" placeholder="Ej: Pastel de Chocolate" required>
        </div>

        <div class="form-group">
            <label for="categoria" class="form-label">Categoría</label>
            <select asp-for="Agregar.PastelCategoria" id="categoria" class="form-select" required>
                <option value="">Seleccionar categoría...</option>
                @foreach (var cat in Model.Categorias)
                {
                    <option value="@cat.Id">@cat.Nombre</option>
                }
            </select>
        </div>

        <div class="form-group">
            <label for="precio" class="form-label">Precio ($)</label>
            <input asp-for="Agregar.Precio" type="number" id="precio" class="form-input" step="0.01" min="0.1" placeholder="Ej: 350.00" required>
        </div>

        <div class="form-group">
            <label for="descripcion" class="form-label">Descripción</label>
            <textarea asp-for="Agregar.Descripcion" id="descripcion" class="form-textarea" placeholder="Descripción del producto..." required></textarea>
        </div>

        <div class="form-group">
            <label for="ingredientes" class="form-label">Ingredientes</label>
            <textarea id="ingredientes" class="form-textarea"
                      placeholder="Ingresa cada ingrediente. Ej:&#10;Harina de trigo&#10;Cacao belga premium&#10;Mantequilla&#10;Huevos frescos"
                      rows="6"></textarea>
        </div>

        <div class="form-group">
            <label for="imagen" class="form-label">Imagen</label>
            <input asp-for="Agregar.Imagen" type="file" id="imagen" class="form-file" accept="image/jpg" required>
            <img id="imagePreview" class="image-preview" src="#" alt="Vista previa de la imagen" style="display: none;">
        </div>

        <div class="form-group">
            <label class="form-label">Ingredientes</label>

            <div id="contenedor-ingredientes">
                <input type="text" name="Agregar.Ingredientes" class="form-input" placeholder="Ej: Harina">
            </div>

            <button type="button" class="btn btn-primary" onclick="agregarIngrediente()">
                Agregar otro ingrediente
            </button>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn btn-success">Agregar Producto</button>
            <a href="~/Admin/Home/Index" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileUpload = document.getElementById('imagen');
        const imagePreview = document.getElementById('imagePreview');

        fileUpload.addEventListener('change', function () {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });
    });

    function agregarIngrediente() {
        const cont = document.getElementById("contenedor-ingredientes");
        const input = document.createElement("input");
        input.type = "text";
        input.name = "Agregar.Ingredientes";
        input.className = "form-input";
        input.placeholder = "Ingrediente";
        cont.appendChild(input);
    }
</script>
